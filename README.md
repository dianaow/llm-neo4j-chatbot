# Neo4j-backed Chatbot using Next.js and TypeScript

### This chatbot, with a simple chat interface, helps to recommend **skincare products** based on a user's queries. 
#### Currently, this chatbot only has knowledge of 10 skincare products fed into a Neo4j database and will not provide recommendations based on it's on pre-trained knowledge.

**In a real-world application, the graph database should be seeded with the entire catalogue of a company's products. In the case of an e-commerce marketplace, a chatbot may be used to help users conveniently identify suitable products to purchase.**
You may view the graph dataset [HERE](https://github.com/dianaow/llm-neo4j-chatbot/blob/main/data/graph.json)

Functionality:
- Accept the user input as a string along with a Session ID generated by the framework
- Use any conversation history to rephrase the input into a standalone question
- Pass the rephrased question to an Agent that will utilize tools to satisfy the request

Tools: 
- RetrievalChain: A tool that uses a Retriever to search the vector index of embedded product descriptions to find products that match a particular query, for example: "Can you recommend a product containing natural ingredeints?".
- CypherChain: A tool capable of writing Cypher and executing statements for more complicated questions, for example: "Which products treat uneven skin texture?"

The tools will also save the LLMâ€™s response and associated metadata to the database. You will use this information to improve future responses generated by the LLM. These chains will supply an LLM with the information required to converse with the user.

#### This is an overview of the Neo4j graph.
![Image of Knowledge Graph](https://github.com/dianaow/llm-neo4j-chatbot/blob/main/assets/graph_overview.png)

<br>

####  Each Product node is connected to nodes related to its attribute, such as brand, benefits and ingredients. Each paragraph of free form text describing the proeduct is it's own node, with the text converted and stored as embeddings in Neo4j. Each 'description' node is connected to a Product node.
![Image of Knowledge Graph](https://github.com/dianaow/llm-neo4j-chatbot/blob/main/assets/graph_model.png)

<br>

#### The green Response nodes are formed when a prompt is made on the chatbot, and represent conversation history. Storing conversation history empowers the chatbot to maintain context throughout extended dialogues. 
![Image of Knowledge Graph](https://github.com/dianaow/llm-neo4j-chatbot/blob/main/assets/graph_response.png)

### Setup your Config

To set config, create a `.env.local` with connection details for your Neo4j Sandbox instance and an OpenAI API Key.
You can also configure the name and description of the chatbot, and the initial greeting message.

```
NEO4J_URI=bolt://12.34.56.789:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=your-generated-password
NEO4J_DATABASE="neo4j"

OPENAI_API_KEY=sk-...
```

### Ingest knowledge graph into Neo4j

The JSON data of the 10 skincare products were ingested into a Neo4J database with Python code found [HERE](https://github.com/dianaow/llm-neo4j-chatbot/blob/main/data/ingest_neo4j.ipynb). To have the chatbot working locally, you have to first ingest this dataset into your own Neo4j instance, and then create vector embeddings for the values in the 'description' nodes.


### Running the application

To run the application, you must install the dependencies listed in `package.json`.
```
npm i
```

Then run the `npm run dev` command to start the app on link:http://localhost:3000/[http://localhost:3000/^].

```
npm run dev
```

### Chat Interface

To test the chatbot, here are some sample questions: 
- "Which products treat blackheads?"
- "Which products treat dullness?"

![Image of UI](https://github.com/dianaow/llm-neo4j-chatbot/blob/main/assets/ui.png)

